{% extends 'root.twig' %}

{% block title %}
    User List
{% endblock %}

{% block headers %}
    <link rel="stylesheet" href="{{ ASSETS_URL }}/css/user/sort.css">
    <link rel="stylesheet" href="{{ ASSETS_URL }}/css/utility/scrollbar.css">
    <script src="https://kit.fontawesome.com/c3d300ba56.js" crossorigin="anonymous"></script>
{% endblock %}

{% block panel_title %}
    User List
{% endblock %}

{% set paths = [
    { 'name': 'Dashboard', 'url': '/dashboard' },
    { 'name': 'User List', 'url': '/users' }
] %}

{% block body %}
    <!-- Notifications -->
    {% if success is defined and success %}
        <div class="notification success bg-green-100 border-l-4 border-green-500 text-green-700 p-4 fixed top-4 left-0 right-0 z-[999]" role="alert">
            <p class="font-bold">Success</p>
            <ul><li>{{ success }}</li></ul>
        </div>
    {% endif %}
    {% if error is defined and error %}
        <div class="notification error bg-red-100 border-l-4 border-red-500 text-red-700 p-4 fixed top-4 left-0 right-0 z-[999]" role="alert">
            <p class="font-bold">Error</p>
            <ul><li>{{ error }}</li></ul>
        </div>
    {% endif %}

    <!-- Modals -->
    {% include 'add-user-modal.html.twig' %}
    {% include 'delete-user-modal.html.twig' %}
    {% include 'update-user-modal.html.twig' %}

    <!-- Statistics Section -->
    <section class="statistics-section mt-4">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
            {% set stats = [
                { 'icon': 'fa-users', 'bg': 'bg-blue-100', 'color': 'text-blue-500', 'label': 'Total Users', 'value': total_users },
                { 'icon': 'fa-user-plus', 'bg': 'bg-green-100', 'color': 'text-green-500', 'label': 'Total New Users', 'value': total_new_users },
                { 'icon': 'fa-chart-pie', 'bg': 'bg-yellow-100', 'color': 'text-yellow-500', 'label': 'Role Statistics', 'isList': true, 'list': role_statistics }
            ] %}
            
            {% for stat in stats %}
                <div class="card bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <div class="flex items-center space-x-4">
                        <div class="icon {{ stat.bg }} {{ stat.color }} p-3 rounded-full">
                            <i class="fa-solid {{ stat.icon }} fa-lg"></i>
                        </div>
                        <div class="info">
                            <p class="text-gray-700 dark:text-gray-400 font-semibold">{{ stat.label }}</p>
                            {% if stat.isList %}
                                <ul class="text-sm text-gray-700 dark:text-gray-400 mt-2">
                                    {% for roleStat in stat.list %}
                                        <li>{{ roleStat.role | capitalize }}: <span class="font-bold">{{ roleStat.count }}</span></li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">{{ stat.value }}</h3>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>
<!-- Action Bar -->
<section class="action-bar mb-4">
    <div class="flex items-center justify-end space-x-4">
        <!-- Search Input -->
        <div class="relative">
            <input 
                type="text" 
                placeholder="Search users..." 
                class="search-input border border-gray-300 rounded-lg px-3 py-2 w-60 dark:bg-gray-700 dark:text-white"
            />
            <button class="absolute top-1/2 right-3 -translate-y-1/2 text-gray-500 hover:text-gray-800 dark:hover:text-white">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>

        <div class="relative inline-block">
            <button class="filter-btn flex items-center space-x-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-white px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                <i class="fa-solid fa-filter"></i>
                <span>Sort</span>
            </button>
        </div>

                <!-- Add User Button -->
        <button 
            class="add-user-btn bg-[#2998FF] text-white px-4 py-2 rounded-lg font-semibold hover:bg-[#2278d3]" 
            onclick="openAddUserModal()">
            Add User
        </button>
    </div>
</section>

 <!-- User List Section -->
<section class="user-list-section">
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-4">
        <div class="overflow-y-auto" style="max-height: 550px;">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-left text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-300">
                    <tr>
                        <th scope="col" class="p-4">ID</th>
                        <th scope="col" class="px-6 py-3">Name</th>
                        <th scope="col" class="px-6 py-3">Email Address</th>
                        <th scope="col" class="px-6 py-3">Contact No</th>
                        <th scope="col" class="px-6 py-3">Gender</th>
                        <th scope="col" class="px-6 py-3">Role</th>
                        <th scope="col" class="px-6 py-3">Actions</th>
                    </tr>
                </thead>
                <tbody style="min-height: 500px;">
                    {% for user in users %}
                        <tr class="bg-white border-b hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-600">
                            <td class="px-6 py-4">{{ user.id }}</td>
                            <td class="px-6 py-4 flex items-center space-x-3">
                                <!-- Profile Picture -->
                                {% if user.profile_picture %}
                                    <img 
                                        src="data:image/jpeg;base64,{{ user.profile_picture }}" 
                                        alt="Profile Picture" 
                                        class="w-10 h-10 rounded-full object-cover"
                                    />
                                {% else %}
                                    <div class="icon bg-gray-200 dark:bg-gray-700 rounded-full w-10 h-10 flex items-center justify-center text-gray-500 dark:text-gray-400">
                                        <i class="fa-solid fa-user fa-lg"></i>
                                    </div>
                                {% endif %}
                                <!-- Full Name -->
                                <div>
                                    <span class="font-bold text-gray-900 dark:text-white">{{ user.first_name }} {{ user.last_name }}</span>
                                    <br>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">{{ user.username }}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4">{{ user.email_address }}</td>
                            <td class="px-6 py-4">{{ user.contact_no }}</td>
                            <td class="px-6 py-4">{{ user.gender | capitalize }}</td>
                            <td class="px-6 py-4">
                                <span class="inline-block px-3 py-1 rounded-lg text-white 
                                    {% if user.role == 'administrator' %} bg-blue-500
                                    {% elseif user.role == 'inventory_manager' %} bg-green-500
                                    {% elseif user.role == 'finance_manager' %} bg-yellow-500
                                    {% elseif user.role == 'hr_manager' %} bg-pink-500
                                    {% else %} bg-purple-500
                                    {% endif %} text-xs">
                                    {{ user.role | capitalize }}
                                </span>
                            </td>
                            <td class="px-6 py-4 space-x-2">
                                <button class="text-blue-600 hover:text-blue-800" onclick="openUpdateUserModal({{ user|json_encode }})">
                                    <i class="fa-solid fa-pen"></i> Edit
                                </button>
                                <button class="text-red-600 hover:text-red-800" onclick="openDeleteUserModal({{ user.id }})">
                                    <i class="fa-solid fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="7" class="text-center px-6 py-4 text-gray-500 dark:text-gray-400">No users found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
    <script src="{{ ASSETS_URL }}/js/user/updateUserModal.js"></script>
    <script src="{{ ASSETS_URL }}/js/user/addUser.js"></script>
    <script src="{{ ASSETS_URL }}/js/user/deleteUser.js"></script>
    <script src="{{ ASSETS_URL }}/js/user/sortuser.js"></script>
{% endblock %}
