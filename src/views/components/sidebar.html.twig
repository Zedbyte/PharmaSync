<nav class="sidebar">
    <ul class="sidebar__ul">
        <!-- Dashboard -->
        <li class="nav__item">
            <a href="/dashboard" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                <ion-icon name="grid-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                <span class="nav__name dark:text-[#fdfdfd]">Dashboard</span>
            </a>
        </li>

        {% if userRole == 'administrator' or userRole == 'finance_manager' %}
            <li class="nav__label dark:!text-[#fdfdfd]">FINANCES</li>

        <!-- Purchases (Collapsible) -->
        <!-- <li class="nav__item">
            <button class="nav__link nav__link_button collapsible justify-between dark:hover:!bg-[#7655fa]" onclick="toggleCollapse('purchases', this)">
                <span class="flex items-center expanded__label">  
                    <ion-icon name="card-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                    <span class="dark:text-[#fdfdfd]">Purchases</span>
                </span>
                <ion-icon name="chevron-forward-outline" class="arrow expanded__label dark:!text-[#fdfdfd]"></ion-icon>
            </button>
            <ul id="purchases" class="nav__collapse transition-all ease-in-out duration-300 overflow-hidden max-h-0 opacity-0 dark:!bg-gray-700">
                <li class="nav__subitem">
                    <a href="/purchase-list" class="nav__link_subitem text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                        <ion-icon name="clipboard-outline"></ion-icon>
                        <span>Purchase List</span>
                    </a>
                </li>
                <li class="nav__subitem">
                    <a href="#" class="nav__link_subitem text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                        <ion-icon name="water-outline"></ion-icon>
                        <span>Material</span>
                    </a>
                </li>
                <li class="nav__subitem">
                    <a href="#" class="nav__link_subitem text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                        <ion-icon name="pulse-outline"></ion-icon>
                        <span>Medicine</span>
                    </a>
                </li>
            </ul>
        </li> -->
            <li class="nav__item">
                <a href="/purchase-list" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                    <ion-icon name="card-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                    <span class="dark:text-[#fdfdfd]">Purchases</span>
                </a>
            </li>

            <!-- Orders -->
            <li class="nav__item">
                <a href="/order-list" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                    <ion-icon name="list-circle-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                    <span class="dark:text-[#fdfdfd]">Orders</span>
                </a>
            </li>
        {% endif %}

        
        {% if userRole == 'administrator' or userRole == 'inventory_manager' %}
            <li class="nav__label dark:!text-[#fdfdfd]">STORAGE</li>

            <!-- Inventory (Collapsible) -->
            <li class="nav__item">
                <button class="nav__link nav__link_button collapsible justify-between dark:hover:!bg-[#7655fa]" onclick="toggleCollapse('inventory', this)">
                    <span class="flex items-center expanded__label">
                        <ion-icon name="cube-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                        <span class="dark:text-[#fdfdfd]">Inventory</span>
                    </span>
                    <ion-icon name="chevron-forward-outline" class="arrow expanded__label dark:!text-[#fdfdfd]"></ion-icon>
                </button>
                <ul id="inventory" class="nav__collapse transition-all ease-in-out duration-300 overflow-hidden max-h-0 opacity-0 dark:!bg-gray-700">
                    <li class="nav__subitem">
                        <a href="/inventory/manufactured" class="nav__link_subitem nav__link_active text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                            <ion-icon name="cube-outline"></ion-icon>
                            <span>Manufactured</span>
                        </a>
                    </li>
                    <li class="nav__subitem">
                        <a href="/inventory/raw" class="nav__link_subitem nav__link_active text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                            <ion-icon name="leaf-outline"></ion-icon>
                            <span>Raw Materials</span>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Medicine -->
            <li class="nav__item">
                <button class="nav__link nav__link_button collapsible justify-between dark:hover:!bg-[#7655fa]" onclick="toggleCollapse('medicine', this)">
                    <span class="flex items-center expanded__label">
                        <ion-icon name="medkit-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                        <span class="dark:text-[#fdfdfd]">Medicine</span>
                    </span>
                    <ion-icon name="chevron-forward-outline" class="arrow expanded__label dark:!text-[#fdfdfd]"></ion-icon>
                </button>
                <ul id="medicine" class="nav__collapse transition-all ease-in-out duration-300 overflow-hidden max-h-0 opacity-0 dark:!bg-gray-700">
                    <li class="nav__subitem">
                        <a href="/medicine-list" class="nav__link_subitem nav__link_active text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                            <ion-icon name="flask-outline"></ion-icon>
                            <span>Formulation</span>
                        </a>
                    </li>
                    <li class="nav__subitem">
                        <a href="/batch-list" class="nav__link_subitem nav__link_active text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                            <ion-icon name="bookmarks-outline"></ion-icon>
                            <span>Batches & Racks</span>
                        </a>
                    </li>
                    <li class="nav__subitem">
                        <a href="/ask-groq" class="nav__link_subitem nav__link_active text-[#2e2e2e] dark:!text-[#fdfdfd] dark:hover:!text-[#b29fff]">
                            <ion-icon name="help-outline"></ion-icon>
                            <span>Ask Groq</span>
                        </a>
                    </li>
                </ul>
            </li>
        {% endif %}
        

        {% if userRole == 'administrator' or userRole == 'hr_manager' %}
            <li class="nav__label dark:!text-[#fdfdfd]">CUSTOMERS</li>

            <!-- Customers -->
            <li class="nav__item">
                <a href="/customer-list" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                    <ion-icon name="people-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                    <span class="dark:text-[#fdfdfd]">Customers</span>
                </a>
            </li>

            <li class="nav__label dark:!text-[#fdfdfd]">SUPPLIERS</li>

            <!-- Supplier -->
            <li class="nav__item">
                <a href="/supplier-list" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                    <ion-icon name="people-circle-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                    <span class="dark:text-[#fdfdfd]">Supplier</span>
                </a>
            </li>

            <li class="nav__label dark:!text-[#fdfdfd]" id="#important">USERS</li>

            <!-- Users -->
            <li class="nav__item">
                <a href="/users-list" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                    <ion-icon name="person-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                    <span class="dark:text-[#fdfdfd]">Users</span>
                </a>
            </li>
        {% endif %}

        <!-- Payroll -->
        <!-- <li class="nav__item">
            <a href="/null" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                <ion-icon name="receipt-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                <span class="dark:text-[#fdfdfd]">Payroll</span>
            </a>
        </li> -->

        <li class="nav__label dark:!text-[#fdfdfd]">CONFIGURATIONS</li>

        <!-- Log Out -->
        <li class="nav__item">
            <a href="/logout" class="nav__link nav__link_active dark:hover:!bg-[#7655fa]">
                <ion-icon name="log-out-outline" class="dark:text-[#fdfdfd]"></ion-icon>
                <span class="dark:text-[#fdfdfd]">Log out</span>
            </a>
        </li>
    </ul>
</nav>

<script>
    /* TO BE REMOVED IF SIDEBAR CREATES AN ERROR DUE TO TRANSITION DELAY */
    /* COLLAPSIBLE CLASS [UL] nav__collapse hidden dark:!bg-gray-700"> */
    function toggleCollapse(id, button) {
        const collapseSection = document.getElementById(id);
        const isExpanded = collapseSection.classList.contains('expanded');
        const sectionHeight = collapseSection.scrollHeight;
    
        if (!isExpanded) {
            // Expand: Set max-height to the actual height and trigger transition
            collapseSection.style.maxHeight = sectionHeight + "px"; 
            collapseSection.classList.add('expanded');
            button.classList.add('expanded');
    
            // Remove max-height after transition to allow natural expansion
            collapseSection.addEventListener('transitionend', function handleExpandEnd() {
                collapseSection.style.maxHeight = 'none';  // Allow the content to expand without a fixed height
                collapseSection.removeEventListener('transitionend', handleExpandEnd);  // Remove listener to avoid repeated triggers
            });
        } else {
            // Collapse: Reset max-height to current height and trigger collapse transition
            collapseSection.classList.remove('expanded');
            button.classList.remove('expanded');
            collapseSection.style.maxHeight = sectionHeight + "px";
            collapseSection.offsetHeight;  // Force reflow to apply height before transition
            collapseSection.style.maxHeight = '0';  // Trigger collapse transition
    
            collapseSection.addEventListener('transitionend', function handleCollapseEnd() {
                collapseSection.style.maxHeight = '';  // Reset to original state
                collapseSection.removeEventListener('transitionend', handleCollapseEnd);  // Remove listener
            });
        }
    }
    
</script>
